{"version":3,"file":"index.js","sources":["../../../../src/activities/generateVideo/index.ts"],"sourcesContent":["/**\n * Video Activity (Experimental)\n *\n * Generates videos from text prompts using a jobs/polling architecture.\n * This is a self-contained module with implementation, types, and JSDoc.\n *\n * @experimental Video generation is an experimental feature and may change.\n */\n\nimport type { VideoAdapter } from './adapter'\nimport type {\n  VideoJobResult,\n  VideoStatusResult,\n  VideoUrlResult,\n} from '../../types'\n\n// ===========================\n// Activity Kind\n// ===========================\n\n/** The adapter kind this activity handles */\nexport const kind = 'video' as const\n\n// ===========================\n// Type Extraction Helpers\n// ===========================\n\n/**\n * Extract provider options from a VideoAdapter via ~types.\n */\nexport type VideoProviderOptions<TAdapter> =\n  TAdapter extends VideoAdapter<any, any>\n    ? TAdapter['~types']['providerOptions']\n    : object\n\n// ===========================\n// Activity Options Types\n// ===========================\n\n/**\n * Base options shared by all video activity operations.\n * The model is extracted from the adapter's model property.\n */\ninterface VideoActivityBaseOptions<\n  TAdapter extends VideoAdapter<string, object>,\n> {\n  /** The video adapter to use (must be created with a model) */\n  adapter: TAdapter & { kind: typeof kind }\n}\n\n/**\n * Options for creating a new video generation job.\n * The model is extracted from the adapter's model property.\n *\n * @experimental Video generation is an experimental feature and may change.\n */\nexport interface VideoCreateOptions<\n  TAdapter extends VideoAdapter<string, object>,\n> extends VideoActivityBaseOptions<TAdapter> {\n  /** Request type - create a new job (default if not specified) */\n  request?: 'create'\n  /** Text description of the desired video */\n  prompt: string\n  /** Video size in WIDTHxHEIGHT format (e.g., \"1280x720\") */\n  size?: string\n  /** Video duration in seconds */\n  duration?: number\n  /** Provider-specific options for video generation */\n  modelOptions?: VideoProviderOptions<TAdapter>\n}\n\n/**\n * Options for polling the status of a video generation job.\n *\n * @experimental Video generation is an experimental feature and may change.\n */\nexport interface VideoStatusOptions<\n  TAdapter extends VideoAdapter<string, object>,\n> extends VideoActivityBaseOptions<TAdapter> {\n  /** Request type - get job status */\n  request: 'status'\n  /** The job ID to check status for */\n  jobId: string\n}\n\n/**\n * Options for getting the URL of a completed video.\n *\n * @experimental Video generation is an experimental feature and may change.\n */\nexport interface VideoUrlOptions<\n  TAdapter extends VideoAdapter<string, object>,\n> extends VideoActivityBaseOptions<TAdapter> {\n  /** Request type - get video URL */\n  request: 'url'\n  /** The job ID to get URL for */\n  jobId: string\n}\n\n/**\n * Union type for all video activity options.\n * Discriminated by the `request` field.\n *\n * @experimental Video generation is an experimental feature and may change.\n */\nexport type VideoActivityOptions<\n  TAdapter extends VideoAdapter<string, object>,\n  TRequest extends 'create' | 'status' | 'url' = 'create',\n> = TRequest extends 'status'\n  ? VideoStatusOptions<TAdapter>\n  : TRequest extends 'url'\n    ? VideoUrlOptions<TAdapter>\n    : VideoCreateOptions<TAdapter>\n\n// ===========================\n// Activity Result Types\n// ===========================\n\n/**\n * Result type for the video activity, based on request type.\n *\n * @experimental Video generation is an experimental feature and may change.\n */\nexport type VideoActivityResult<\n  TRequest extends 'create' | 'status' | 'url' = 'create',\n> = TRequest extends 'status'\n  ? Promise<VideoStatusResult>\n  : TRequest extends 'url'\n    ? Promise<VideoUrlResult>\n    : Promise<VideoJobResult>\n\n// ===========================\n// Activity Implementation\n// ===========================\n\n/**\n * Generate video - creates a video generation job from a text prompt.\n *\n * Uses AI video generation models to create videos based on natural language descriptions.\n * Unlike image generation, video generation is asynchronous and requires polling for completion.\n *\n * @experimental Video generation is an experimental feature and may change.\n *\n * @example Create a video generation job\n * ```ts\n * import { generateVideo } from '@tanstack/ai'\n * import { openaiVideo } from '@tanstack/ai-openai'\n *\n * // Start a video generation job\n * const { jobId } = await generateVideo({\n *   adapter: openaiVideo('sora-2'),\n *   prompt: 'A cat chasing a dog in a sunny park'\n * })\n *\n * console.log('Job started:', jobId)\n * ```\n */\nexport async function generateVideo<\n  TAdapter extends VideoAdapter<string, object>,\n>(options: VideoCreateOptions<TAdapter>): Promise<VideoJobResult> {\n  const { adapter, prompt, size, duration, modelOptions } = options\n  const model = adapter.model\n\n  return adapter.createVideoJob({\n    model,\n    prompt,\n    size,\n    duration,\n    modelOptions,\n  })\n}\n\n/**\n * Get video job status - returns the current status, progress, and URL if available.\n *\n * This function combines status checking and URL retrieval. If the job is completed,\n * it will automatically fetch and include the video URL.\n *\n * @experimental Video generation is an experimental feature and may change.\n *\n * @example Check job status\n * ```ts\n * import { getVideoJobStatus } from '@tanstack/ai'\n * import { openaiVideo } from '@tanstack/ai-openai'\n *\n * const result = await getVideoJobStatus({\n *   adapter: openaiVideo('sora-2'),\n *   jobId: 'job-123'\n * })\n *\n * console.log('Status:', result.status)\n * console.log('Progress:', result.progress)\n * if (result.url) {\n *   console.log('Video URL:', result.url)\n * }\n * ```\n */\nexport async function getVideoJobStatus<\n  TAdapter extends VideoAdapter<string, object>,\n>(options: {\n  adapter: TAdapter & { kind: typeof kind }\n  jobId: string\n}): Promise<{\n  status: 'pending' | 'processing' | 'completed' | 'failed'\n  progress?: number\n  url?: string\n  error?: string\n}> {\n  const { adapter, jobId } = options\n\n  // Get status first\n  const statusResult = await adapter.getVideoStatus(jobId)\n\n  // If completed, also get the URL\n  if (statusResult.status === 'completed') {\n    try {\n      const urlResult = await adapter.getVideoUrl(jobId)\n      return {\n        status: statusResult.status,\n        progress: statusResult.progress,\n        url: urlResult.url,\n      }\n    } catch (error) {\n      // If URL fetch fails, still return status\n      return {\n        status: statusResult.status,\n        progress: statusResult.progress,\n        error:\n          error instanceof Error ? error.message : 'Failed to get video URL',\n      }\n    }\n  }\n\n  // Return status for non-completed jobs\n  return {\n    status: statusResult.status,\n    progress: statusResult.progress,\n    error: statusResult.error,\n  }\n}\n\n// ===========================\n// Options Factory\n// ===========================\n\n/**\n * Create typed options for the generateVideo() function without executing.\n */\nexport function createVideoOptions<\n  TAdapter extends VideoAdapter<string, object>,\n>(options: VideoCreateOptions<TAdapter>): VideoCreateOptions<TAdapter> {\n  return options\n}\n\n// Re-export adapter types\nexport type {\n  VideoAdapter,\n  VideoAdapterConfig,\n  AnyVideoAdapter,\n} from './adapter'\nexport { BaseVideoAdapter } from './adapter'\n"],"names":[],"mappings":"AAqBO,MAAM,OAAO;AAwIpB,eAAsB,cAEpB,SAAgE;AAChE,QAAM,EAAE,SAAS,QAAQ,MAAM,UAAU,iBAAiB;AAC1D,QAAM,QAAQ,QAAQ;AAEtB,SAAO,QAAQ,eAAe;AAAA,IAC5B;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD;AACH;AA2BA,eAAsB,kBAEpB,SAQC;AACD,QAAM,EAAE,SAAS,MAAA,IAAU;AAG3B,QAAM,eAAe,MAAM,QAAQ,eAAe,KAAK;AAGvD,MAAI,aAAa,WAAW,aAAa;AACvC,QAAI;AACF,YAAM,YAAY,MAAM,QAAQ,YAAY,KAAK;AACjD,aAAO;AAAA,QACL,QAAQ,aAAa;AAAA,QACrB,UAAU,aAAa;AAAA,QACvB,KAAK,UAAU;AAAA,MAAA;AAAA,IAEnB,SAAS,OAAO;AAEd,aAAO;AAAA,QACL,QAAQ,aAAa;AAAA,QACrB,UAAU,aAAa;AAAA,QACvB,OACE,iBAAiB,QAAQ,MAAM,UAAU;AAAA,MAAA;AAAA,IAE/C;AAAA,EACF;AAGA,SAAO;AAAA,IACL,QAAQ,aAAa;AAAA,IACrB,UAAU,aAAa;AAAA,IACvB,OAAO,aAAa;AAAA,EAAA;AAExB;AASO,SAAS,mBAEd,SAAqE;AACrE,SAAO;AACT;"}