{"version":3,"file":"index.js","sources":["../../../../src/activities/summarize/index.ts"],"sourcesContent":["/**\n * Summarize Activity\n *\n * Generates summaries from text input.\n * This is a self-contained module with implementation, types, and JSDoc.\n */\n\nimport { aiEventClient } from '../../event-client.js'\nimport type { SummarizeAdapter } from './adapter'\nimport type {\n  StreamChunk,\n  SummarizationOptions,\n  SummarizationResult,\n} from '../../types'\n\n// ===========================\n// Activity Kind\n// ===========================\n\n/** The adapter kind this activity handles */\nexport const kind = 'summarize' as const\n\n// ===========================\n// Type Extraction Helpers\n// ===========================\n\n/** Extract provider options from a SummarizeAdapter via ~types */\nexport type SummarizeProviderOptions<TAdapter> =\n  TAdapter extends SummarizeAdapter<any, any>\n    ? TAdapter['~types']['providerOptions']\n    : object\n\n// ===========================\n// Activity Options Type\n// ===========================\n\n/**\n * Options for the summarize activity.\n * The model is extracted from the adapter's model property.\n *\n * @template TAdapter - The summarize adapter type\n * @template TStream - Whether to stream the output\n */\nexport interface SummarizeActivityOptions<\n  TAdapter extends SummarizeAdapter<string, object>,\n  TStream extends boolean = false,\n> {\n  /** The summarize adapter to use (must be created with a model) */\n  adapter: TAdapter & { kind: typeof kind }\n  /** The text to summarize */\n  text: string\n  /** Maximum length of the summary (in words or characters, provider-dependent) */\n  maxLength?: number\n  /** Style of summary to generate */\n  style?: 'bullet-points' | 'paragraph' | 'concise'\n  /** Topics or aspects to focus on in the summary */\n  focus?: Array<string>\n  /** Provider-specific options */\n  modelOptions?: SummarizeProviderOptions<TAdapter>\n  /**\n   * Whether to stream the summarization result.\n   * When true, returns an AsyncIterable<StreamChunk> for streaming output.\n   * When false or not provided, returns a Promise<SummarizationResult>.\n   *\n   * @default false\n   */\n  stream?: TStream\n}\n\n// ===========================\n// Activity Result Type\n// ===========================\n\n/**\n * Result type for the summarize activity.\n * - If stream is true: AsyncIterable<StreamChunk>\n * - Otherwise: Promise<SummarizationResult>\n */\nexport type SummarizeActivityResult<TStream extends boolean> =\n  TStream extends true\n    ? AsyncIterable<StreamChunk>\n    : Promise<SummarizationResult>\n\n// ===========================\n// Helper Functions\n// ===========================\n\nfunction createId(prefix: string): string {\n  return `${prefix}-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`\n}\n\n// ===========================\n// Activity Implementation\n// ===========================\n\n/**\n * Summarize activity - generates summaries from text.\n *\n * Supports both streaming and non-streaming modes.\n *\n * @example Basic summarization\n * ```ts\n * import { summarize } from '@tanstack/ai'\n * import { openaiSummarize } from '@tanstack/ai-openai'\n *\n * const result = await summarize({\n *   adapter: openaiSummarize('gpt-4o-mini'),\n *   text: 'Long article text here...'\n * })\n *\n * console.log(result.summary)\n * ```\n *\n * @example Summarization with style\n * ```ts\n * const result = await summarize({\n *   adapter: openaiSummarize('gpt-4o-mini'),\n *   text: 'Long article text here...',\n *   style: 'bullet-points',\n *   maxLength: 100\n * })\n * ```\n *\n * @example Focused summarization\n * ```ts\n * const result = await summarize({\n *   adapter: openaiSummarize('gpt-4o-mini'),\n *   text: 'Long technical document...',\n *   focus: ['key findings', 'methodology']\n * })\n * ```\n *\n * @example Streaming summarization\n * ```ts\n * for await (const chunk of summarize({\n *   adapter: openaiSummarize('gpt-4o-mini'),\n *   text: 'Long article text here...',\n *   stream: true\n * })) {\n *   if (chunk.type === 'content') {\n *     process.stdout.write(chunk.delta)\n *   }\n * }\n * ```\n */\nexport function summarize<\n  TAdapter extends SummarizeAdapter<string, object>,\n  TStream extends boolean = false,\n>(\n  options: SummarizeActivityOptions<TAdapter, TStream>,\n): SummarizeActivityResult<TStream> {\n  const { stream } = options\n\n  if (stream) {\n    return runStreamingSummarize(\n      options as unknown as SummarizeActivityOptions<\n        SummarizeAdapter<string, object>,\n        true\n      >,\n    ) as SummarizeActivityResult<TStream>\n  }\n\n  return runSummarize(\n    options as unknown as SummarizeActivityOptions<\n      SummarizeAdapter<string, object>,\n      false\n    >,\n  ) as SummarizeActivityResult<TStream>\n}\n\n/**\n * Run non-streaming summarization\n */\nasync function runSummarize(\n  options: SummarizeActivityOptions<SummarizeAdapter<string, object>, false>,\n): Promise<SummarizationResult> {\n  const { adapter, text, maxLength, style, focus } = options\n  const model = adapter.model\n  const requestId = createId('summarize')\n  const inputLength = text.length\n  const startTime = Date.now()\n\n  aiEventClient.emit('summarize:started', {\n    requestId,\n    model,\n    inputLength,\n    timestamp: startTime,\n  })\n\n  const summarizeOptions: SummarizationOptions = {\n    model,\n    text,\n    maxLength,\n    style,\n    focus,\n  }\n\n  const result = await adapter.summarize(summarizeOptions)\n\n  const duration = Date.now() - startTime\n  const outputLength = result.summary.length\n\n  aiEventClient.emit('summarize:completed', {\n    requestId,\n    model,\n    inputLength,\n    outputLength,\n    duration,\n    timestamp: Date.now(),\n  })\n\n  return result\n}\n\n/**\n * Run streaming summarization\n * Uses the adapter's native streaming if available, otherwise falls back\n * to non-streaming and yields the result as a single chunk.\n */\nasync function* runStreamingSummarize(\n  options: SummarizeActivityOptions<SummarizeAdapter<string, object>, true>,\n): AsyncIterable<StreamChunk> {\n  const { adapter, text, maxLength, style, focus } = options\n  const model = adapter.model\n\n  const summarizeOptions: SummarizationOptions = {\n    model,\n    text,\n    maxLength,\n    style,\n    focus,\n  }\n\n  // Use real streaming if the adapter supports it\n  if (adapter.summarizeStream) {\n    yield* adapter.summarizeStream(summarizeOptions)\n    return\n  }\n\n  // Fall back to non-streaming and yield as a single chunk\n  const result = await adapter.summarize(summarizeOptions)\n\n  // Yield content chunk with the summary\n  yield {\n    type: 'content',\n    id: result.id,\n    model: result.model,\n    timestamp: Date.now(),\n    delta: result.summary,\n    content: result.summary,\n    role: 'assistant',\n  }\n\n  // Yield done chunk\n  yield {\n    type: 'done',\n    id: result.id,\n    model: result.model,\n    timestamp: Date.now(),\n    finishReason: 'stop',\n    usage: result.usage,\n  }\n}\n\n// ===========================\n// Options Factory\n// ===========================\n\n/**\n * Create typed options for the summarize() function without executing.\n */\nexport function createSummarizeOptions<\n  TAdapter extends SummarizeAdapter<string, object>,\n  TStream extends boolean = false,\n>(\n  options: SummarizeActivityOptions<TAdapter, TStream>,\n): SummarizeActivityOptions<TAdapter, TStream> {\n  return options\n}\n\n// Re-export adapter types\nexport type {\n  SummarizeAdapter,\n  SummarizeAdapterConfig,\n  AnySummarizeAdapter,\n} from './adapter'\nexport { BaseSummarizeAdapter } from './adapter'\n"],"names":[],"mappings":";AAoBO,MAAM,OAAO;AAmEpB,SAAS,SAAS,QAAwB;AACxC,SAAO,GAAG,MAAM,IAAI,KAAK,IAAA,CAAK,IAAI,KAAK,OAAA,EAAS,SAAS,EAAE,EAAE,MAAM,GAAG,CAAC,CAAC;AAC1E;AAwDO,SAAS,UAId,SACkC;AAClC,QAAM,EAAE,WAAW;AAEnB,MAAI,QAAQ;AACV,WAAO;AAAA,MACL;AAAA,IAAA;AAAA,EAKJ;AAEA,SAAO;AAAA,IACL;AAAA,EAAA;AAKJ;AAKA,eAAe,aACb,SAC8B;AAC9B,QAAM,EAAE,SAAS,MAAM,WAAW,OAAO,UAAU;AACnD,QAAM,QAAQ,QAAQ;AACtB,QAAM,YAAY,SAAS,WAAW;AACtC,QAAM,cAAc,KAAK;AACzB,QAAM,YAAY,KAAK,IAAA;AAEvB,gBAAc,KAAK,qBAAqB;AAAA,IACtC;AAAA,IACA;AAAA,IACA;AAAA,IACA,WAAW;AAAA,EAAA,CACZ;AAED,QAAM,mBAAyC;AAAA,IAC7C;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAGF,QAAM,SAAS,MAAM,QAAQ,UAAU,gBAAgB;AAEvD,QAAM,WAAW,KAAK,IAAA,IAAQ;AAC9B,QAAM,eAAe,OAAO,QAAQ;AAEpC,gBAAc,KAAK,uBAAuB;AAAA,IACxC;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,WAAW,KAAK,IAAA;AAAA,EAAI,CACrB;AAED,SAAO;AACT;AAOA,gBAAgB,sBACd,SAC4B;AAC5B,QAAM,EAAE,SAAS,MAAM,WAAW,OAAO,UAAU;AACnD,QAAM,QAAQ,QAAQ;AAEtB,QAAM,mBAAyC;AAAA,IAC7C;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAIF,MAAI,QAAQ,iBAAiB;AAC3B,WAAO,QAAQ,gBAAgB,gBAAgB;AAC/C;AAAA,EACF;AAGA,QAAM,SAAS,MAAM,QAAQ,UAAU,gBAAgB;AAGvD,QAAM;AAAA,IACJ,MAAM;AAAA,IACN,IAAI,OAAO;AAAA,IACX,OAAO,OAAO;AAAA,IACd,WAAW,KAAK,IAAA;AAAA,IAChB,OAAO,OAAO;AAAA,IACd,SAAS,OAAO;AAAA,IAChB,MAAM;AAAA,EAAA;AAIR,QAAM;AAAA,IACJ,MAAM;AAAA,IACN,IAAI,OAAO;AAAA,IACX,OAAO,OAAO;AAAA,IACd,WAAW,KAAK,IAAA;AAAA,IAChB,cAAc;AAAA,IACd,OAAO,OAAO;AAAA,EAAA;AAElB;AASO,SAAS,uBAId,SAC6C;AAC7C,SAAO;AACT;"}